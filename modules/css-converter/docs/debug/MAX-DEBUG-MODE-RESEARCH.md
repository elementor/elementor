# Maximum Debug Mode - Complete Research Guide

## Overview

Maximum debug mode in WordPress enables comprehensive logging, error reporting, and debugging tools to help developers identify and fix issues. This is configured primarily through the `wp-config.php` file.

---

## WordPress Debug Constants (wp-config.php)

### 1. **WP_DEBUG** - Master Debug Flag
```php
define( 'WP_DEBUG', true );
```
- **Effect**: Enables WordPress debug mode
- **When true**: WordPress will display all PHP errors, notices, and warnings (if WP_DEBUG_DISPLAY is true)
- **Recommended**: Set to `true` during development, `false` in production

### 2. **WP_DEBUG_LOG** - File-based Logging
```php
define( 'WP_DEBUG_LOG', true );
```
- **Effect**: Writes all errors/warnings to `/wp-content/debug.log` file
- **Benefit**: Doesn't display errors on site (good for production debugging)
- **Log Location**: `/wp-content/debug.log`
- **Recommended**: Always `true` in development

### 3. **WP_DEBUG_DISPLAY** - Display On Screen
```php
define( 'WP_DEBUG_DISPLAY', true );  // or false
```
- **true**: Shows errors directly on the website (frontend)
- **false**: Hides errors from frontend but still logs them
- **Recommended**: Set to `false` in production for security

### 4. **SCRIPT_DEBUG** - Unminified Scripts/Styles
```php
define( 'SCRIPT_DEBUG', true );
```
- **Effect**: Loads unminified CSS and JavaScript files
- **Benefit**: Better for debugging frontend code, easier to trace issues
- **Impact**: CSS loads `styles.css` instead of `styles.min.css`
- **Recommended**: `true` during development

### 5. **SAVEQUERIES** - Database Query Logging
```php
define( 'SAVEQUERIES', true );
```
- **Effect**: Stores all database queries in `$GLOBALS['wpdb']->queries`
- **Use**: Access via `var_dump( $GLOBALS['wpdb']->queries )` in theme/plugin
- **Recommended**: `true` for performance debugging

### 6. **ELEMENTOR_SHOW_HIDDEN_EXPERIMENTS** - Elementor Experiments
```php
define( 'ELEMENTOR_SHOW_HIDDEN_EXPERIMENTS', true );
```
- **Effect**: Shows experimental features in Elementor editor
- **Benefit**: Access to new features and debugging tools
- **Note**: Specific to Elementor plugin

---

## Current Setup in This Environment

### wp-config.php Settings (Lines 73-79):
```php
if ( ! defined( 'WP_DEBUG' ) ) {
    define( 'WP_DEBUG', true );
    define( 'WP_DEBUG_LOG', true );
    define( 'WP_DEBUG_DISPLAY', false );
    define( 'ELEMENTOR_SHOW_HIDDEN_EXPERIMENTS', true );
    define( 'SCRIPT_DEBUG', true );
}

ini_set( 'error_reporting', E_ALL & ~E_DEPRECATED & ~E_STRICT );
ini_set( 'display_errors', 0 );
```

**Status**: ✅ **Maximum Debug Mode is ALREADY ENABLED** (except WP_DEBUG_DISPLAY)

---

## Maximum Debug Mode Configuration

To enable absolute maximum debugging, use this configuration:

### Option 1: Production-Safe (Recommended)
```php
/**
 * Maximum Debug Mode (Production Safe)
 * Logs all errors to file, doesn't display on site
 */
define( 'WP_DEBUG', true );
define( 'WP_DEBUG_LOG', true );
define( 'WP_DEBUG_DISPLAY', false );
define( 'SCRIPT_DEBUG', true );
define( 'SAVEQUERIES', true );
define( 'ELEMENTOR_SHOW_HIDDEN_EXPERIMENTS', true );

// PHP Error Reporting
ini_set( 'error_reporting', E_ALL );
ini_set( 'display_errors', 0 );

// Advanced Logging
define( 'CONCATENATE_SCRIPTS', false );  // Don't combine JS files
define( 'COMPRESS_SCRIPTS', false );     // Don't compress JS
define( 'COMPRESS_CSS', false );         // Don't compress CSS
```

### Option 2: Development (Show All Errors)
```php
/**
 * Maximum Debug Mode (Development)
 * Shows all errors on screen and logs to file
 */
define( 'WP_DEBUG', true );
define( 'WP_DEBUG_LOG', true );
define( 'WP_DEBUG_DISPLAY', true );
define( 'SCRIPT_DEBUG', true );
define( 'SAVEQUERIES', true );
define( 'ELEMENTOR_SHOW_HIDDEN_EXPERIMENTS', true );

// PHP Error Reporting
ini_set( 'error_reporting', E_ALL );
ini_set( 'display_errors', 1 );

// Advanced Logging
define( 'CONCATENATE_SCRIPTS', false );
define( 'COMPRESS_SCRIPTS', false );
define( 'COMPRESS_CSS', false );
```

---

## PHP Error Constants

### Error Reporting Levels:

```php
// Report all errors
ini_set( 'error_reporting', E_ALL );

// Report all except deprecated
ini_set( 'error_reporting', E_ALL & ~E_DEPRECATED );

// Report errors and warnings only
ini_set( 'error_reporting', E_ERROR | E_WARNING );

// Individual error types:
// E_ERROR              - Fatal user-generated error
// E_WARNING            - Non-fatal user-generated warning
// E_PARSE              - Compile-time parse error
// E_NOTICE             - Runtime notice (often ignored)
// E_CORE_ERROR         - Fatal error generated by PHP
// E_CORE_WARNING       - Non-fatal warning by PHP
// E_COMPILE_ERROR      - Compile-time error
// E_COMPILE_WARNING    - Compile-time warning
// E_USER_ERROR         - Fatal user error
// E_USER_WARNING       - Non-fatal user warning
// E_USER_NOTICE        - User notice
// E_STRICT             - Runtime notice for code compatibility
// E_DEPRECATED         - Usage of deprecated code
// E_ALL                - All errors, warnings, and notices
```

---

## Logging Locations

### 1. **WordPress Debug Log**
- **Location**: `/wp-content/debug.log`
- **Created**: Automatically when WP_DEBUG_LOG is true
- **Contains**: All WordPress errors and notices
- **Access**: View via SFTP or file manager

### 2. **PHP Error Log**
- **Location**: Varies by server configuration
  - Often: `/var/log/php-errors.log`
  - Or defined by `php.ini`: `error_log` directive
- **Contains**: PHP-level errors
- **Check Server**: Ask hosting provider for location

### 3. **Web Server Error Logs**
- **Apache**: Usually `/var/log/apache2/error.log`
- **Nginx**: Usually `/var/log/nginx/error.log`
- **Docker**: View via `docker logs` command

### 4. **Elementor Debug Logs**
- **Location**: `/wp-content/uploads/elementor/`
- **Contains**: Elementor-specific errors

---

## Accessing the Debug Log

### Method 1: Browser (WordPress Plugins)
Install the **Query Monitor** plugin:
```
1. Go to wp-admin → Plugins → Add New
2. Search: "Query Monitor"
3. Activate: John Blackbourn
4. View real-time queries and errors
```

### Method 2: Command Line
```bash
# View last 50 lines
tail -50 /wp-content/debug.log

# Watch log in real-time
tail -f /wp-content/debug.log

# Search for specific errors
grep "ERROR" /wp-content/debug.log

# Count errors
wc -l /wp-content/debug.log

# Clear the log
echo "" > /wp-content/debug.log
```

### Method 3: File Manager/SFTP
- Connect to server via SFTP
- Navigate to `/wp-content/`
- Download `debug.log`
- Open in text editor

---

## For Debugging Nested Variables Issue

### Recommended Configuration:

```php
// Add this to wp-config.php for the nested variables debugging:

define( 'WP_DEBUG', true );
define( 'WP_DEBUG_LOG', true );
define( 'WP_DEBUG_DISPLAY', false );
define( 'SCRIPT_DEBUG', true );
define( 'SAVEQUERIES', true );

// PHP Reporting - catch everything
ini_set( 'error_reporting', E_ALL );
ini_set( 'display_errors', 0 );  // Log, don't display

// Performance Tuning - disabled for debugging
define( 'CONCATENATE_SCRIPTS', false );
define( 'COMPRESS_SCRIPTS', false );
define( 'COMPRESS_CSS', false );
```

### To Add Debug Logging to Code:

**In PHP (variables-route.php):**
```php
// Log the extracted variables
error_log( 'NESTED VARS BEFORE: ' . print_r( $scoped_variables, true ) );

// Process...

error_log( 'NESTED VARS AFTER: ' . print_r( $raw, true ) );

// Check what's being converted
error_log( 'CONVERTED VARS: ' . print_r( $converted, true ) );
```

**View the log:**
```bash
tail -f /path/to/wp-content/debug.log
```

---

## Advanced Debugging Tools

### 1. **Xdebug** (Step-through Debugging)
```php
// Enable in php.ini
zend_extension=xdebug.so
xdebug.mode=debug
xdebug.start_with_request=yes
xdebug.client_host=127.0.0.1
xdebug.client_port=9003
```

### 2. **Query Monitor Plugin** (Real-time)
- Frontend toolbar showing queries, hooks, errors
- Useful for performance analysis
- Install: `wp plugin install query-monitor --activate`

### 3. **WordPress REST API Debugging**
```php
// Add to wp-config.php
define( 'REST_DEBUG', true );
```

### 4. **Elementor Logger**
Located in: `plugins/elementor/core/logger/manager.php`

```php
// To use Elementor's logger in plugins:
use Elementor\Core\Logger\Logger;

Logger::error( 'My error message' );
Logger::debug( 'Debug information' );
```

---

## Troubleshooting the Nested Variables

### Step 1: Enable Maximum Debug
Edit `/wp-config.php`:
```php
define( 'WP_DEBUG', true );
define( 'WP_DEBUG_LOG', true );
define( 'SAVEQUERIES', true );
```

### Step 2: Add Temporary Logging
In `modules/css-converter/routes/variables-route.php`, after line 123:
```php
$scoped_variables = $parser->extract_variables_with_nesting( $parsed );
error_log( '=== SCOPED VARIABLES ===' );
error_log( print_r( $scoped_variables, true ) );

$raw = $this->extract_and_rename_nested_variables( $scoped_variables );
error_log( '=== AFTER EXTRACT_AND_RENAME ===' );
error_log( print_r( $raw, true ) );

$converted = \Elementor\Modules\CssConverter\Services\Variables\Variable_Conversion_Service::convert_to_editor_variables( $normalized );
error_log( '=== AFTER CONVERSION ===' );
error_log( print_r( $converted, true ) );
```

### Step 3: Run Test & Check Log
```bash
cd /path/to/wp-content
tail -f debug.log
```

Run one of the failing Playwright tests in another terminal and watch the log update.

### Step 4: Analyze the Data Flow
Compare the data at each stage:
- What does `extract_variables_with_nesting()` return?
- What does `extract_and_rename_nested_variables()` produce?
- What does `convert_to_editor_variables()` output?
- What actually gets saved to the database?

---

## Performance Considerations

When debugging, disable caching:
```php
// Disable caching
define( 'WP_CACHE', false );

// Disable object cache
wp_cache_flush();

// Disable query caching
wp_cache_flush();
```

But remember to **re-enable for production**:
```php
define( 'WP_CACHE', true );
```

---

## Summary

**Current Status**: ✅ Maximum debug is already enabled in this environment

**To Use for Debugging**:
1. View log: `tail -f /wp-content/debug.log`
2. Add logging statements to code
3. Run tests
4. Analyze output in debug.log

**Key Files**:
- Config: `/wp-config.php` (lines 73-82)
- Log: `/wp-content/debug.log`
- Parser: `/plugins/elementor-css/modules/css-converter/routes/variables-route.php`

**Next Action**: Add error_log() statements to trace the nested variables through the entire pipeline.

