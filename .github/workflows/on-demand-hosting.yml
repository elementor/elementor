name: On Demand Hosting
description: On Demand Hosting

on: 
  workflow_dispatch:
    inputs:
      SITE_URL:
        description: 'The site URL'
        required: true


permissions:
  contents: write
  pull-requests: write
  actions: read

jobs:
  build-plugin:
    name: Build plugin
    uses: ./.github/workflows/build.yml

  deploy-to-hosting:
    name: Deploy to On Demand Hosting
    runs-on: ubuntu-22.04
    needs: [build-plugin]
    steps:
      - name: Checkout source code
        uses: actions/checkout@v4
      
      - name: Download build artifact
        uses: actions/download-artifact@v4
        with:
          name: ${{ needs.build-plugin.outputs.artifact_name }}
          path: ./build
      
      - name: Upload to SFTP server
        run: |
          echo "Deploying to site: ${{ inputs.SITE_URL }}"
          echo "Built artifact downloaded to ./build"
          
          # Package the artifact
          cd ./build
          zip -r ../elementor-plugin.zip .
          cd ..
          
          # Install sshpass for SFTP authentication
          sudo apt-get update && sudo apt-get install -y sshpass
          
          # Upload to SFTP server
          echo "Uploading elementor-plugin.zip to SFTP server..."
          sshpass -p 'fxkVvDNT6gi74T91' sftp -P 32022 -o StrictHostKeyChecking=no lSVllGgK@sftp.stg.elementor.cool << EOF
          put elementor-plugin.zip
          quit
          EOF
          
          echo "âœ… Plugin successfully uploaded to SFTP server"
          echo "ðŸ“ File: elementor-plugin.zip"
          echo "ðŸ–¥ï¸  Host: sftp.stg.elementor.cool:32022"
          echo "ðŸš€ Ready to deploy plugin to: ${{ inputs.SITE_URL }}"


