name: Manual Create Revert PR

on:
  workflow_dispatch:
    inputs:
      pr_number:
        description: 'PR number to revert'
        required: false
      commit_sha:
        description: 'Commit SHA to revert (if not using PR number)'
        required: false
      branch:
        description: 'Target branch (main or 3.XX)'
        required: true
        default: 'main'

jobs:
  create-revert:
    runs-on: ubuntu-22.04
    steps:
      - name: Checkout source code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}
          ref: ${{ inputs.branch }}

      - name: Get commit SHA from PR
        id: get-commit
        if: ${{ inputs.pr_number }}
        run: |
          PR_DATA=$(gh pr view ${{ inputs.pr_number }} --json mergeCommit --jq '.mergeCommit.oid')
          echo "commit_sha=$PR_DATA" >> $GITHUB_OUTPUT
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Create revert PR
        uses: ./.github/workflows/create-revert-pr
        with:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          COMMIT_SHA: ${{ inputs.pr_number && steps.get-commit.outputs.commit_sha || inputs.commit_sha }}
          BRANCH_NAME: ${{ inputs.branch }}
          WORKFLOW_NAME: "Playwright"
          WORKFLOW_RUN_URL: "Manual revert trigger"
          ALLOW_WORKFLOW_CHANGES: 'true'

