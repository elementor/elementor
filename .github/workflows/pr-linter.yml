name: PR Linter
on:
  pull_request:
    types: ['opened', 'edited', 'reopened', 'synchronize']
    paths-ignore:
      - '**.md'
      - '**.txt'
      - '.github/config.json'
      - 'bin/**'
      - '.gitignore'
      - 'docs/**'
  merge_group:

# This allows a subsequently queued workflow run to interrupt previous runs
concurrency:
  group: '${{ github.workflow }} @ ${{ github.event.pull_request.head.label || github.head_ref || github.ref }}'
  cancel-in-progress: true

jobs:
  pr_name_lint:
    runs-on: ubuntu-latest
    if: startsWith( github.repository, 'elementor/' )
    steps:
      - uses: actions/checkout@v4
      - name: Install Node.js 20.x
        uses: actions/setup-node@v4
        with:
          node-version: 20.x
      - name: Install Dependencies
        if: ${{ github.event.pull_request.title != null }}
        run: npm install --no-package-lock --no-save @commitlint/config-conventional@12.1.1 @commitlint/cli@12.1.1
      - name: Run PR name linter
        if: ${{ github.event.pull_request.title != null }}
        env:
          TITLE: ${{ github.event.pull_request.title }}
        run: echo "$TITLE" | npx commitlint

  check-css-size:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Find and Check CSS Files
        run: |
          MAX_SIZE=51200  # 50 KB in bytes
          EXIT_CODE=0

          # Find all frontend.css files and check their sizes
          for file in $(find . -name 'frontend.css'); do
            FILE_SIZE=$(stat -c%s "$file")
            echo "Checking $file (Size: $FILE_SIZE bytes)"

            if [ "$FILE_SIZE" -gt "$MAX_SIZE" ]; then
              echo "Error: $file exceeds size limit of $MAX_SIZE bytes!"
              EXIT_CODE=1
            fi
          done

          exit $EXIT_CODE
